import{a as _e,b as be,c as T,d as I,e as q,f as H,g as ye}from"./chunk-GBDNDGCT.js";import{a as Ce}from"./chunk-XFDKH5E3.js";import{a as F,b as N}from"./chunk-MC5SZHMA.js";import{a as le,b as de,c as fe}from"./chunk-Z6AK2GEV.js";import{a as ue}from"./chunk-2EMY2H7W.js";import{b as me}from"./chunk-D7C7R5DL.js";import{Ba as C,Ca as z,Da as _,E as Y,Ea as ne,Eb as se,Fa as re,Fb as U,Ga as pe,Ha as S,I as Z,Ia as D,Ja as R,K as ee,Ka as h,M as E,Oa as ce,P as te,Qa as ae,S as f,Sa as b,V as oe,W as ie,_a as G,d as K,f as Q,fb as l,g as V,gb as u,m as X,ma as w,mb as L,p as d,q as A,rb as M,ta as P,ub as j,w as k}from"./chunk-UHKDLVDU.js";var ve=Object.defineProperty,O=(e,r)=>ve(e,"name",{value:r,configurable:!0}),J=O((e,r)=>t=>{let{bufferSize:o=1,refCount:p=!0}=r??{},c=new Q,a=[],n=!1,s=0,m=null,y=null,$=O(()=>{y?.unsubscribe(),y=null,a.length=0},"clear"),B=O(()=>{y?.unsubscribe(),y=t.subscribe({next(i){a.push(i),a.length>o&&a.shift(),c.next(i)},error(i){c.error(i)},complete(){c.complete()}})},"subscribeToSource"),x=O(()=>{m?.unsubscribe(),m=e.subscribe(i=>{n=i,i?s&&B():$()})},"subscribeToAvailability");return new K(i=>{s++;let g=c.subscribe(i);return m?a.forEach(Te=>i.next(Te)):x(),n&&!y&&B(),()=>{s--,g.unsubscribe(),!s&&(!n||p)&&($(),m?.unsubscribe(),m=null)}})},"publishWhile");var Be=0,ge=1e3,v=e=>{let{input:r,loader:t,processResponse:o=i=>i,processError:p=i=>i,mapOperator:c=ee,active:a=new V(!0),attempts:n=Be,timeout:s=ge,destroyRef:m=H()}=e,y=!m,$=r||X(!0),B=new V(!0),x=A([$,B,a]).pipe(d(([i])=>i),c(i=>t(i).pipe(d(g=>o(g,i)),ye(n,s,g=>p(g,i)))),m?F(m):E(),J(a,{refCount:y}));return{data:x.pipe(k(q)),error:x.pipe(k(i=>!T(i)),d(i=>I(i)?i.error:!1)),loading:x.pipe(d(T)),active:a,raw:x,reload:()=>B.next(!0)}},W=(e,r,t)=>{let o=t??H(),p=!t,c=A(e.map(n=>n.active)).pipe(d(n=>n.every(Boolean)),Y(),o?F(t):E(),Z({bufferSize:1,refCount:!0})),a=A(e.map(n=>n.raw)).pipe(d(n=>n.some(s=>T(s))?{state:_e}:n.some(s=>I(s))?{state:be,error:n.map(s=>I(s)?s.error:!1)}:r(n)),t?F(t):E(),J(c,{refCount:p}));return{data:a.pipe(k(q)),error:a.pipe(k(n=>!T(n)),d(n=>I(n)?n.error:!1)),loading:a.pipe(d(T)),active:c,raw:a,reload:()=>e.forEach(n=>n.reload())}};var xe=(()=>{class e{productsApi=f(fe);store=v({loader:()=>this.productsApi.allProducts$(),processError:()=>"Can't load products"});productByIdStore={};getStoreById(t){return this.productByIdStore[t]??=v({loader:()=>this.productsApi.getProduct$(t),processError:(o,p)=>`Can't load product ${p}`})}getCombinedStoreByIds(t){let o=t.map(p=>this.getStoreById(p));return W(o,p=>p)}static \u0275fac=function(o){return new(o||e)};static \u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function we(e,r){if(e&1){let t=ce();D(0,"app-generic-error",4),ae("reload",function(){oe(t);let p=b();return ie(p.clientStore.reload())}),R()}e&2&&S("showReload",!0)("text",r)}function Re(e,r){if(e&1&&(h(0,"app-client-info",2),l(1,"async")),e&2){let t=b();S("displayData",u(1,1,t.clientStore.data))}}function Ie(e,r){if(e&1&&h(0,"app-generic-error",5),e&2){let t=b().$implicit;S("text",t)}}function $e(e,r){if(e&1&&C(0,Ie,1,1,"app-generic-error",5),e&2){let t=r.$implicit;_(t?0:-1)}}function Ae(e,r){e&1&&re(0,$e,1,1,null,null,ne),e&2&&pe(r)}function Ee(e,r){e&1&&h(0,"app-client-bucket",6),e&2&&S("bucket",r)}function Pe(e,r){if(e&1&&(C(0,Ee,1,1,"app-client-bucket",6),l(1,"async")),e&2){let t,o=b(2);_((t=u(1,1,o.populatedBucketStore.data))?0:-1,t)}}function De(e,r){if(e&1&&(D(0,"div"),l(1,"async"),C(2,Ae,2,0),l(3,"async"),z(4,Pe,2,3),R()),e&2){let t,o=b();G("loading",u(1,3,o.populatedBucketStore.loading)),w(2),_((t=u(3,5,o.populatedBucketStore.error))?2:4,t)}}var he=(()=>{class e{clientId=L.required();showBucket=L();clientsApi=f(me);bucketApi=f(de);productsStore=f(xe).store;clientStore=v({input:N(this.clientId),loader:t=>this.clientsApi.getClient$(t),processError:()=>"Can't load client"});bucketStore=v({input:N(this.clientId),loader:t=>this.bucketApi.getClientBucket$(t),processError:()=>"Can't load bucket"});populatedBucketStore=W([this.bucketStore,this.productsStore],([t,o])=>se(t,o));static \u0275fac=function(o){return new(o||e)};static \u0275cmp=P({type:e,selectors:[["app-tiny-rx-store"]],inputs:{clientId:[1,"clientId"],showBucket:[1,"showBucket"]},decls:7,vars:8,consts:[[1,"max-w-screen-lg"],[3,"showReload","text"],[3,"displayData"],[3,"loading"],[3,"reload","showReload","text"],[3,"text"],[3,"bucket"]],template:function(o,p){if(o&1&&(D(0,"div",0)(1,"div"),l(2,"async"),C(3,we,1,2,"app-generic-error",1),l(4,"async"),z(5,Re,2,3,"app-client-info",2),R(),C(6,De,5,7,"div",3),R()),o&2){let c;w(),G("loading",u(2,4,p.clientStore.loading)),w(2),_((c=u(4,6,p.clientStore.error))?3:5,c),w(3),_(p.showBucket()?6:-1)}},dependencies:[j,ue,le,Ce,M],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return e})();function Me(e,r){if(e&1&&(h(0,"app-tiny-rx-store",0),l(1,"async")),e&2){let t=b();S("clientId",r)("showBucket",u(1,2,t.showBucket$)??!1)}}var ft=(()=>{class e{counter$=f(U).clientId$;showBucket$=f(U).showBucket$;static \u0275fac=function(o){return new(o||e)};static \u0275cmp=P({type:e,selectors:[["app-tiny-store-input-wrapper"]],decls:2,vars:3,consts:[[3,"clientId","showBucket"]],template:function(o,p){if(o&1&&(C(0,Me,2,4,"app-tiny-rx-store",0),l(1,"async")),o&2){let c;_((c=u(1,1,p.counter$))?0:-1,c)}},dependencies:[j,he,M],encapsulation:2})}return e})();export{ft as TinyRxStoreInputWrapperComponent};
