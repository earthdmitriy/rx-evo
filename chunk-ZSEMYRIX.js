import{A as B,I as O,K as F,L as I,M as v,f as z,g as A,l as k,m as u,n as K,p as c,q as x,v as y,w as b,z as P}from"./chunk-UHKDLVDU.js";var w=Symbol("loading"),S=Symbol("error"),f=r=>r?.state===w,p=r=>r?.state===S,m=r=>!f(r)&&!p(r);var E=r=>{let t=Math.max(0,Math.floor(r)),e=new Map;return{set:(s,n)=>{if(t!==0)for(e.has(s)&&e.delete(s),e.set(s,n);e.size>t;){let l=e.keys().next().value;if(l===void 0)break;e.delete(l)}},get:s=>{let n=e.get(s);return n===void 0?null:(e.delete(s),e.set(s,n),n)},getAll:()=>Array.from(e.values()),reset:s=>{if(!s){e.clear();return}for(let[n,l]of e.entries())s(l)&&e.delete(n)}}};var R=()=>P(r=>u({state:S,error:r}));var T=()=>c(()=>({state:w})),V=()=>O({bufferSize:1,refCount:!0}),M=(r,t)=>r.pipe.apply(r,t);var W=(...r)=>t=>M(t,r),U=(...r)=>t=>{let o=t.pipe(b(m)).pipe(B(i=>M(u(i),r).pipe(R()))),a=t.pipe(b(i=>!m(i)));return y(a,o)},_=(...r)=>t=>{let e=t.pipe(b(p),c(i=>i.error)),o=M(e,r).pipe(c(i=>({state:S,error:i}))),a=t.pipe(b(i=>!p(i)));return y(o,a)};var q=r=>t=>{if(!t)return r.subscribe;if(typeof t=="function"){let o=r.subscribe({next:a=>{m(a)&&t(a)}});return{unsubscribe:()=>o.unsubscribe()}}let e=r.subscribe({next:o=>{f(o)&&t.pending?.(!0),m(o)&&(t.next?.(o),t.pending?.(!1)),p(o)&&(t.error?.(o.error),t.pending?.(!1))},error:o=>{t.error?.(o)},complete:()=>{t.complete?.()}});return{unsubscribe:()=>e.unsubscribe()}};var g=(r,t)=>{let e=r.pipe(V());return{raw$:e,reload:t,value$:e.pipe(b(m)),error$:e.pipe(b(o=>!f(o)),c(o=>p(o)?o.error:!1)),pending$:e.pipe(c(f)),pipe:(...o)=>g(e.pipe(W(...o)),t),pipeValue:(...o)=>g(e.pipe(U(...o)),t),pipeError:(...o)=>g(e.pipe(_(...o)),t),subscribe:q(e)}};var H=r=>typeof r=="function"?{loader:r}:K(r)?{input:r}:r,j=r=>{let{input:t,loader:e,mapOperator:o=F,cacheKey:a=()=>[],cacheSize:h=42}=H(r),i=t??u(!0),s=new A(E(h)),n=x([i,s]).pipe(T(),R()),l=d=>e?e(d):u(d),D=x([i,s]).pipe(c(([d,$])=>({input:d,cache:$,key:a(d).join("|")})),o(({input:d,cache:$,key:C})=>{if(C){let L=$.get(C);if(L)return u(L)}return k(l(d)).pipe(v({next:L=>$.set(C,L)}),R())}),R()),G=y(n,D);return g(G,()=>s.next(E(h)))};var J=r=>{let t=E(r.cacheSize??42),e=new z;return{get:i=>{let s=(r.cacheKey??(n=>[n]))(i).join("|");return t.get(s)?.[0]??(()=>{let n=0,l=j({input:u(i),loader:r.loader,mapOperator:r.mapOperator}).pipe(I(e),O(1),v({subscribe:()=>{n++},unsubscribe:()=>{n--}}));return t.set(s,[l,n]),l})()},reset:i=>{i&&e.next(),t.reset(i?void 0:([s,n])=>n===0)},reload:()=>{t.getAll().forEach(([i])=>{i.reload()})}}};var Q=(r,t)=>g(x(r.map(e=>e.raw$)).pipe(c(e=>e.some(o=>f(o))?{state:w}:e.some(o=>p(o))?{state:S,error:e.map(o=>p(o)?o.error:!1)}:t(e))),()=>r.forEach(e=>e.reload()));export{f as a,p as b,j as c,J as d,Q as e};
